<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>OpenBlue Agent Dashboard</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <header>
      <img src="logo.png" alt="Logo" style="height: 40px; vertical-align: middle; margin-right: 10px;">
      OpenBlue | Agent Dashboard
    </header>

    <div class="container">
      <div class="card">
        <h2>Zone A – Temp Control</h2>
        <p>Status: <span class="status-ok">Stable</span></p>
        <p>Temp: <span id="zoneA-temp">21.2°C</span> (within ±0.5°C)</p>
        <input type="range" id="tempSlider" min="18" max="26" step="0.1" value="21.2" style="width:100%;">
      </div>

      <div class="card" id="card-zoneB">
        <h2>Zone B – Cooling Load</h2>
        <p>Status: <span id="zoneB-status" class="status-alert">Overload</span></p>
        <p>Cooling Demand: <span id="zoneB-demand">142%</span></p>
      </div>

      <div class="card" id="card-fault">
        <h2>Fault Detection</h2>
        <p>Status: <span id="fault-status" class="status-neutral">No anomalies</span></p>
        <p>Last checked: <span id="last-checked">2 minutes ago</span></p>
      </div>

      <div class="card">
        <h2>Agent Sync</h2>
        <p>Status: <span class="status-ok">RAFT quorum achieved</span></p>
        <p>Consensus threshold: 66%</p>
        <button onclick="simulateAlert('zoneB')">Simulate Zone B Overload</button>
        <button onclick="simulateAlert('fault')">Simulate Fault</button>
      </div>

      <div class="card" style="grid-column: span 2;">
        <h2>Cooling Load Over Time</h2>
        <canvas id="coolingChart" height="100"></canvas>
      </div>
    </div>

    <script>
      const alertSound = new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_d7367d6de1.mp3");
      let tempValue = 21.2;
      let timeLabels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
      let loadValues = [320, 400, 290, 500, 420];

      const ctx = document.getElementById('coolingChart').getContext('2d');
      const coolingChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: [...timeLabels],
          datasets: [{
            label: 'Cooling Load (kW)',
            data: [...loadValues],
            backgroundColor: '#0074d9'
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true }
          }
        }
      });

      function flashCard(cardId) {
        const card = document.getElementById(cardId);
        if (card) {
          card.style.transition = "background-color 0.3s";
          card.style.backgroundColor = "#ffe6e6";
          setTimeout(() => card.style.backgroundColor = "white", 600);
        }
      }

      function simulateAlert(type) {
        if (type === 'zoneB') {
          alertSound.play();
          document.getElementById('zoneB-status').innerText = 'Overload';
          document.getElementById('zoneB-status').className = 'status-alert';
          document.getElementById('zoneB-demand').innerText = '155%';
          flashCard('card-zoneB');
        } else if (type === 'fault') {
          alertSound.play();
          document.getElementById('fault-status').innerText = '⚠️ Anomaly Detected';
          document.getElementById('fault-status').className = 'status-alert';
          flashCard('card-fault');
        }
      }

      function updateDashboard() {
        // Update Zone A Temp from slider
        tempValue = document.getElementById('tempSlider').value;
        document.getElementById('zoneA-temp').innerText = `${tempValue}°C`;

        // Random overload status
        const overload = Math.random() < 0.3;
        const statusText = document.getElementById('zoneB-status');
        const demandText = document.getElementById('zoneB-demand');

        if (overload) {
          statusText.innerText = 'Overload';
          statusText.className = 'status-alert';
          demandText.innerText = `${Math.floor(Math.random() * 50 + 130)}%`;
          alertSound.play();
          flashCard("card-zoneB");
        } else {
          statusText.innerText = 'Normal';
          statusText.className = 'status-ok';
          demandText.innerText = `${Math.floor(Math.random() * 40 + 80)}%`;
        }

        // Fault detection
        const fault = Math.random() < 0.1;
        const faultText = document.getElementById('fault-status');
        faultText.innerText = fault ? '⚠️ Anomaly Detected' : 'No anomalies';
        faultText.className = fault ? 'status-alert' : 'status-neutral';
        if (fault) {
          alertSound.play();
          flashCard("card-fault");
        }

        // Update chart with a new point
        const nextLabel = `+${coolingChart.data.labels.length}`;
        const nextValue = Math.floor(Math.random() * 100 + 300);
        coolingChart.data.labels.push(nextLabel);
        coolingChart.data.datasets[0].data.push(nextValue);
        if (coolingChart.data.labels.length > 10) {
          coolingChart.data.labels.shift();
          coolingChart.data.datasets[0].data.shift();
        }
        coolingChart.update();

        // Update last checked
        document.getElementById('last-checked').innerText = 'Just now';
      }

      setInterval(updateDashboard, 5000);
    </script>
  </body>
</html>
